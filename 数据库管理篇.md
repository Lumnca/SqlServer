# ------------------ T-SQL程序 ------------------- #

<p id="title"></p>

## 目录 ##

:arrow_down:<a href="#a1">1.T-SQl简述</a>

:arrow_down:<a href="#a2">2.数据库对象的引用方法</a>

:arrow_down:<a href="#a3">3.T-SQL批处理</a>

:arrow_down:<a href="#a4">4.注释</a>

:arrow_down:<a href="#a5">5.T-SQL数据类型及转换</a>


<p id="a1"></p>

### :umbrella:T-SQl简述 ###

:arrow_double_up:<a href = "#title">返回目录</a>

T-SQL是Transact-SQL的简写，是使用SQL-Server的核心，所有与SQL Server
实例化通信的应用程序，都是通过发送T-SQL语句到服务器来完成对数据库的操作。T-SQL与SQL稍有不同，SQL是结构化查询语言，是目前关系型数据库管理系统使用最广泛的查询语言，T-SQL是在SQL上发展而来的，在SQL基础上添加了流程控制，是SQL的扩展。SQL几乎支持所有的关系型数据库的语言，而T-SQL是支持SQL-Server的语言。


<p id="a2"></p>

### :umbrella:数据库对象的引用方法 ###

:arrow_double_up:<a href = "#title">返回目录</a>

* 引用数据库对象的方法

在SQl Server2014中，除了另外指定外，所有的数据库对象的T-SQL引用都是由以下四个部分组成的名称：

```sql
server_name.[database_name].[schema_name].object_name
```

|名称|说明|
|:---:|:----:|
|server_name|链接服务器名称或远程服务器名称|
|database_name|如果是本地示例，则是数据库的名称，如果对象在链接服务器中，这是OLE DB的目录|
|schema_name|如果对象在SQL Server数据库中，则是包含对象的架构的名称，如果是服务器中，则是OLE DB架构名称|
|object_name|对象名称|


对于四部分，中间的架构省略可以使用.代替，省略最前面的可以不写，缩写方式：

```sql
server_name.database_name.schema_name.object_name     --全称
server_name.database_name..object_name            --省略架构
server_name..schema_name.object_name         --省略数据库名称
server_name...object_name               --省略数据库和架构名称
database_name.schema_name.object_name          --省略服务器名
schema_name.object_name               --省略数据库和服务器名称
object_name                                  --只有对象（常用）
```

* 架构

在前面多次提到架构，那么架构是什么呢？架构形成单个命名空间的数据实体的集合，命名空间是一个集合，其中每个元素的名称都是唯一的，在同一个架构中不能有相同类型的相同名称的数据库对象，例如，为了避免名称冲突，同一架构中不能有两个相同的表，两个表只有位于不同的架构中才可以同名。在SQL-Server2012中，默认的构架是dbo，如果在创建数据库对象时没有指定框架，那么默认将数据库对象放在dbo中,如下，数据表，视图，存储过程的构架都是dbo。

![](https://github.com/Lumnca/StudySqlServer/blob/master/Image/a27.png)


<p id="a3"></p>

### :umbrella:T-SQL批处理 ###

:arrow_double_up:<a href = "#title">返回目录</a>

在SQL Server2012中，可以一次执行多个T-SQL语句，这样多个T-SQl语句称为‘批’。在SQl Server中会将一批SQl语句当成一个执行单元，将其编译
后一次执行，而不是将一个个T-SQL语句编译后再一个个执行。

执行一个更新语句：

```sql
INSERT Student_Infor  values ('小和','20170124','女',1,2018)

SELECT * FROM Student_Infor WHERE Class = 1

UPDATE Student_Infor SET ID = '20170114' 

WHERE Name = '小和'

SELECT * FROM Student_Infor WHERE Class = 1
```

上面就会执行两次操作，分别查看了两种不同时候的数据，像上面语句我们一般使用GO来分隔，不同的批使用GO来分隔开。如下：

```sql
INSERT Student_Infor  values ('小语','20170217','女',2,2018)

SELECT * FROM Student_Infor WHERE Class = 2

GO

UPDATE Student_Infor SET ID = '20170212' 

WHERE Name = '小语'

SELECT * FROM Student_Infor WHERE Class = 2

GO
```
<p id="a4"></p>

### :umbrella:注释 ###

:arrow_double_up:<a href = "#title">返回目录</a>

SQL中注释有两种一种是按行注释： `-- ` 另一种是按文段注释：  `/*   */`

```sql
UPDATE Student_Infor SET ID = '20170212' --这是单行注释

WHERE Name = '小语' /*这是
	段落注释
*/
```

<p id="a5"></p>

### :umbrella:T-SQL数据类型转换 ###

:arrow_double_up:<a href = "#title">返回目录</a>

在SQL-Server中，无论是数据表的字段，常量，变量，表达式还是参数，都具有一个相对应的数据类型，数据类型是一种属性，用于指定对象可保存的数据的类型，需要时，可以进行数据转换。

* 使用Cast转换数据类型

使用格式：`CAST (表达式  AS 数据类型/ 数据类型(长度) )` 其中表达式为任何有效的，数据类型为要转换的类型，如果转换类型有长度，可以添加
长度，一般只对nchar,nvarchar,varchar,binary和varbinary有效。

示例转换数据：

```
SELECT '学生'+ID +  CAST (Class AS varchar(10)) From Student_Infor
```

注意只是在查询时数据改变，表字段类型并未改变。

* 使用Convert转化数据类型

与Cast类似，使用格式:`Convert(数据类型/ 数据类型(长度),表达式)` ，如上一样可以写成：

```sql
SELECT '学生'+ID +  Convert(varchar(10),Class ) AS ID From Student_Infor
```

这种方法一般适用于时间转换，如想对时间类型的数据进行不同的格式输出：

```sql
SELECT 

 Convert(varchar(20),Birth ,1) AS Time1,

 Convert(varchar(20),Birth ,101) AS Time2,

 Convert(varchar(20),Birth ,102) AS Time3

 From Student_Infor
 ```
 
 上面中的1,101,102，代表的是不同类型格式输出。也叫style代码。














